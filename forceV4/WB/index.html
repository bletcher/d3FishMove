<!DOCTYPE html>
<html lang="en">
  
<head>
  <title>Fish Movement</title>
  <meta charset="utf-8">
  
  <a target="_blank" style="outline:none;"><canvas width="900" height="900"></canvas></a>
  
  <script src="https://d3js.org/d3.v4.0.0-alpha.40.min.js"></script>
  <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css">
  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

  <script type='text/javascript' src="http://felek.cns.umass.edu:4444/forceV4/js/functionsV4.js"></script>
  <script type='text/javascript' src="http://felek.cns.umass.edu:4444/forceV4/js/globalVariablesV4.js"></script>
  
  <link rel="stylesheet" href="http://felek.cns.umass.edu:4444/forceV4/css/movementV4.css">
  
</head>

<body>


    <!-- Page Content -->
    <div class="container-fluid">

        <!-- Page Header -->
        <div class="row">
          
    <!--        <div class="col-lg-10">
                <h3 class="page-header">Trout and salmon in a small stream network in western MA, USA
                    <small></small>
                </h3>
     -->       </div>


  
            <div class="col-lg-2">

             <form class="form-inline-vertical"> 
             
             
         <!--    <div class="btn-toolbar">  -->
               <div class="form-group form-group-sm">
                 
                  <div class="form-group">
                    <label for="dotOptionDD" class="col-xs-4">Fish</label>
                      <div class="col-xs-8">
                        <select class="form-control" id="dotOptionDD">
                          <option selected="selected" value="all">All</option>
                          <option value="selected">Selected</option>
                        </select>
                      </div>
                   </div>

                  <div class="form-group">
                    <label for="onClickDD" class="col-xs-4">Click</label>
                      <div class="col-xs-8">  
                        <select class="form-control" id="onClickDD">
                          <option value="ind">Individual</option>
                          <option selected="selected" value="sec">Section</option>
                          <option value="fam">Family</option>
                        </select>
                     </div>
                   </div>
                   
                   <button type="button" class="btn btn-default btn-sm  pull-right" id="unselectAll">Unselect all</button>
                   
               </div>
             </form>
           </div>
         </div> 
       </div>
  
  
  
  
   <button id="btnNext">Next</button> 
</body>

<script>

// Network-specific info ///////////////////////////////////

// Contiguous downstream river for each index (river #)
// needs to be defined by hand for any network
var nextDown = [ 2,2,4,4,6,6,0 ];

// Is the river a terminal trib (eg.g no upstream movement possible)
// needs to be defined by hand for any network
var terminalTrib = [ 1,1,0,1,0,1,0 ];

//////////////////////////////////////////////////////////

d3.select(canvas)
  .on("mousemove", mouseMoved)
  .call(d3.drag()
    .container(canvas)
    .subject(clickDot)  // acts as 'onclick'
    );

// get xy data: file from D:\PITTAGMAIN\West Brook data\ on ben's computer
d3.csv("http://felek.cns.umass.edu:4444/forceV4/WBCoordsForD3JS.csv", type, function (xyIn){
  d3.csv("http://felek.cns.umass.edu:4444/coreDataOut.csv", typeCoreData, function (cd){

    xScale.domain(d3.extent(xyIn, function(d) { return d.lat; }));
    yScale.domain(d3.extent(xyIn, function(d) { return d.lon; }));

    // Initialize state and initializeInterface
    initializeState();
    initializeInterface();
    
    // Initialize network and fish data
    initializeNetwork(xyIn);
    initializeFishData(cd,xyIn);

    updateRenderData();
    
    // force simulation
    simulation = d3.forceSimulation()
      .drag(0.75)
     // .alphaDecay(0.01)
      .force("charge", d3.forceManyBody()
                         .strength(1) //strength of attraction among points [ - repels, + attracts ]
                     //    .theta(0.8)
                         .distanceMax(10)
            )
      .force("collide", d3.forceCollide().radius(function(d) { return ageScale(d.currentAge) + 1.025; })
                           .iterations(1))
      .force("x", d3.forceX().x(function(d) { return xScale(d.coordinate[0]); }).strength(intervalDur / 1000 * strengthAdj)) //bigger strength means faster
      .force("y", d3.forceY().y(function(d) { return yScale(d.coordinate[1]); }).strength(intervalDur / 1000 * strengthAdj)) 
      .on("tick", ticked)
    
  //  simulation.nodes(state.nodesRender).alphaDecay(.05).restart();
    
    // Increment by timeStep
    d3.select('#btnNext')
      .on('click', function() {

          timeStep = timeStep === (maxTimeStep - 2) ? 0 : timeStep + 1;

          updateRenderData();
          incrementSegments();
          
          console.log("timeStep =",timeStep);

      });
  
  }); //coreData
}); //csv  

</script>