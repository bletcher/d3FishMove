<!DOCTYPE HTML>
<html lang="en">
    <head>
      <meta charset="UTF-8">
      <title>West Brook PIT study</title>
    
      <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700" rel="stylesheet" type="text/css">
      <link href="public/css/bootstrap.min.css" rel="stylesheet" type="text/css">
      <link href="public/css/landing-page.css" rel="stylesheet" type="text/css">
      <link href="public/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js"></script>
      <script src="https://d3js.org/d3.v4.min.js"></script>

      <link rel="stylesheet" href="http://dc-js.github.io/dc.js/css/dc.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css" />
    
      <script async="" src="//www.google-analytics.com/analytics.js"></script>
 <!--     <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    
        ga('create', 'UA-53771846-2', 'auto');
        ga('send', 'pageview');
    
      </script>
 -->   
      <style>
        body, h1, h2, h3, h4, h5, h6 {
          font-weight: 400;
          font-family: "Open Sans", Helvetica, Arial, sans-serif !important;
        }
    
        .top-section {
          background: #222;
          color: white;
        }
        
        #map {
          height: 300px;
          width: 400px;
          margin: 0 10px;
          display: block;
          margin: auto;
          width: 80%;

        }
        
        div.tooltip {
          position: absolute;
          padding: 2px;
          font: 12px sans-serif;
          background: #C6C6C6;
          pointer-events: none;
          height: auto; 
          width: 620px;

        }
        
        img {
          max-width: 100%;
          max-height: 100%;
          onerror = "imgError()";
        }
    
      </style>
  </head>
<body>

  <div style="border-bottom: 2px solid #e7e7e7;background:#f8f8f8">
    <div class="container">
      <div class="row">
        <div class="col-xs-12">
          <h1>West Brook fish tagging study </h1>
        </div>
      </div>
    </div>
  </div>
  
  <div class="content-section-b top-section">
    <div class="container">
      <div class="row" style="margin-top: 40px">
        <div class="col-md-6">
          <h2>Why a tagging study?</h2>
          <p style="font-size:1.2em;">Understanding the performance and fate of individuals helps us understand why population abundance fluctuates and why species come and go.</p>
          <p style="font-size:1.2em;">Since 1997, we have studied stream fish using <a href="https://en.wikipedia.org/wiki/Radio-frequency_identification"> tags </a>that contain unique electronic codes. We can estimate body growth, movement and reproduction (performance) and survival (fate) by recapturing tagged fish over time. </p>
          <p style="font-size:1.2em;">Our longest-running study area is the West Brook, in Whately MA. Dots on the map are 20m-long sampling sections. Mouse over a section to see a picture of the section from 2006. Blue dots are the West Brook mainstem. Green, orange and red dots are tributaries. Get a tour of the data by  <a href="http://felek.cns.umass.edu:4444/indTagViz/WB/"> launching the intro</a>.</p>

        </div>
  
        <div class="col-md-6 text-center">
          <h2>Study site location</h2>
          <div>
            <div id="map"></div>
          </div>
          <p><a class="btn btn-lg btn-primary" style="margin-top: 25px" href="http://felek.cns.umass.edu:4444/indTagViz/WB/">Launch Intro <span class="glyphicon glyphicon-chevron-right"></span></a></p>
        </div>
      </div>
    </div>
  </div>
  
    <div class="content-section-b">
    <div class="container">
      <div class="row">
        <div class="col-xs-12 col-md-8">
          <h2>Place holder</h2>
          <p></p>
        </div>
      </div>
    </div>
  </div>
  
  <div class="content-section-a">
    <div class="container">
      <div class="row">
        <div class="col-xs-12 col-md-8">
          <h2>Project Team</h2>
          <p>ICE was developed by <a href="http://walkerenvres.com" target="_blank">Jeffrey D. Walker, PhD</a> and <a href="http://www.lsc.usgs.gov/?q=cafb-ben-letcher" target="_blank">Ben Letcher, PhD</a> through the USGS Conte Anadromous Fish Lab and UMass Amherst Dept. of Environmental Conservation.</p>
          <p>Modeling and database support was provided by Dan Hocking, PhD and Kyle O'Neil. Additional web development support was provided by Chris Jennison.</p>
        </div>
      </div>
    </div>
  </div>
  
  <div class="content-section-b">
    <div class="container">
      <div class="row">
        <div class="col-xs-12 col-md-8">
          <h2>Funding Sources</h2>
          <p>ICE is funded by the <a href="https://necsc.umass.edu/" target="_blank">NE Climate Science Center</a>, <a href="http://northatlanticlcc.org/" target="_blank">North Atlantic Landscape Conservation Cooperative</a>, <a href="http://www.usgs.gov/hurricane/sandy/#overview.html" target="_blank">USGS and DOI Hurricane Sandy Restoration funds</a>, and the <a href="https://nccwsc.usgs.gov/" target="_blank">USGS National Climate Science Center</a>.</p>
        </div>
      </div>
    </div>
  </div>
  

  
  <footer>
    <div class="container">
      <div class="row">
        <div class="col-xs-12">
          <p class="copyright text-muted">Copyright Â© 2016 SHEDS Development Team</p>
          <p class="copyright text-muted"><strong>Disclaimer:</strong> This web site (SHEDS) has not yet been approved by the U.S. Geological Survey (USGS). As such, it does not represent any official USGS finding or policy.</p>
        </div>
      </div>
    </div>
  </footer>


<script>
  var year = 2006, season = 1;
  var locations,locationsMap,feature;
  var map = L.map('map').setView([42.434, -72.669], 15);

  L.tileLayer('http://stamen-tiles-{s}.a.ssl.fastly.net/terrain/{z}/{x}/{y}.{ext}', {
    attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
    subdomains: 'abcd',
    minZoom: 4,
    maxZoom: 18,
    ext: 'png'
  }).addTo(map);
  
  map._initPathRoot();
  
  var svg = d3.select("#map").select("svg"),
      g = svg.append("g");
  
  var tooltip = d3.select("body").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);

// this doesn't get fired on error
  function imgError(){
    console.log("imgError")
    tooltip.html('Image not found')
      .style("left", "100px")
      .style("top",  "160px")
      .transition()
      .duration(100)
      .style("opacity", 1);
  }

  d3.queue()
    .defer(d3.csv, 'data/coordsForD3JS.csv')
    .await(ready);
    
  function ready(error, locations) {
    if (error) throw error; 
   
    locations =  locations.filter( function(dd) {
                                     return dd.watershed == "west" && dd.section > 0 && dd.section < 48;
                                 });
                                 
    // Map
    var riverNames = {
      'West Brook': 'WB',
      'WB Mitchell': 'OS',
      'WB Jimmy': 'OL',
      'WB Obear': 'IL'
    };
    
    locations.forEach(function (d) {
        d.lat = +d.lat;
        d.lon = +d.lon;
        d.river = riverNames[d.riverFull];
        d.LatLng = new L.LatLng(d.lat, d.lon)
    });
    
    console.log(locations) 
   
    var riverColors = d3.scaleOrdinal(d3.schemeCategory10)
      .domain(['WB', 'OS', 'OL', 'IL']);
      
    feature = g.selectAll("circle")
       .data(locations)
       .enter().append("circle")
       .style("stroke", function(d){return d3.rgb(riverColors(d.river)).darker(1)})
       .style("fill", function(d){return riverColors(d.river)})
       .style("opacity", 0.6)
       .attr("r", 4)
       .on("mouseover", function(d){ 
          d3.select(this)
          .style("stroke", "red")
          .style("fill", "lightgrey")
          ;
          var fileName = "img/" + d.river + "_" + year + "_" + season + "_" + d.section + ".jpg";
 //         console.log(d3.event.pageX,d3.event.pageY,fileName,'<img src= ' + fileName + '>')

          tooltip.html('<img src= ' + fileName + '>')
            .style("left", "100px")// (d3.event.pageX + 15) + "px")
            .style("top",  "160px")// (d3.event.pageY - 15) + "px")
            .transition()
            .duration(100)
            .style("opacity", 1);

        })
        
        .on("mouseout", function (d) {
          d3.select(this)
            .style("stroke", function(d){return d3.rgb(riverColors(d.river)).darker(1)})
            .style("fill", function(d){return riverColors(d.river)});
            
          tooltip.transition()
            .duration(250)
            .style("opacity", 0);
        })
       


    map.on("viewreset", onViewReset);
    onViewReset();

    function onViewReset() {
      feature.attr("transform", function(d) {
        return "translate("+
          map.latLngToLayerPoint(d.LatLng).x +","+
          map.latLngToLayerPoint(d.LatLng).y +")";
      });
    }

    
  }  
      
</script>

</body>
</html>